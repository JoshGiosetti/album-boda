<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ricordi Eterni</title>
<style>
body { font-family:"Times New Roman", Times, serif; background:#0B3C91; text-align:center; margin:0; padding:20px; }
.box { background:#FFF; padding:25px; border-radius:14px; max-width:480px; margin:40px auto; box-shadow:0 6px 20px rgba(0,0,0,0.15);}
h1 { color:#0B3C91; margin-bottom:10px;}
button { margin-top:15px; padding:14px; width:100%; background:#0B3C91; border:none; color:#FFF; font-size:16px; border-radius:10px; cursor:pointer;}
button:hover { opacity:0.9;}
#mensaje { margin-top:15px; color:#0B3C91; }
input[type="file"] { display:none; }
</style>
</head>
<body>

<div class="box">
<h1>‚ú®RECUERDOS‚ú®</h1>
<p>üíç X & D üíç</p>

<input type="file" id="cameraInput" accept="image/*" capture="environment" multiple>
<input type="file" id="galleryInput" accept="image/*" multiple>

<button onclick="abrirCamara()">üì∏ Captura el momento</button>
<button onclick="abrirGaleria()">üñºÔ∏è Subir tu recuerdo</button>
<button onclick="subirFotos()">üíæ Guardar tu recuerdo</button>

<p id="mensaje">0 fotos seleccionadas</p>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = "https://fxknmcntonqlvllbpgun.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ4a25tY250b25xbHZsbGJwZ3VuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2NTkwMjksImV4cCI6MjA4NjIzNTAyOX0.J0M_pHArOFRF8_QvHebNWS9E0ZLPlax6tr9fknQ9XOI";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const cameraInput = document.getElementById("cameraInput");
const galleryInput = document.getElementById("galleryInput");
const mensaje = document.getElementById("mensaje");

let fotosSeleccionadas = [];

function abrirCamara(){ cameraInput.click(); }
function abrirGaleria(){ galleryInput.click(); }

cameraInput.addEventListener("change", e => seleccionarFotos(e));
galleryInput.addEventListener("change", e => seleccionarFotos(e));

function seleccionarFotos(e){
  fotosSeleccionadas = Array.from(e.target.files);
  mensaje.innerText = fotosSeleccionadas.length + " foto(s) seleccionadas";
}

// Subida de fotos optimizada
async function subirFotos(){
  if(fotosSeleccionadas.length === 0){
    mensaje.innerText = "No seleccionaste fotos";
    return;
  }

  mensaje.innerText = "Subiendo fotos...";

  try {
    await Promise.all(fotosSeleccionadas.map(async foto => {
      const nombreArchivo = Date.now() + "_" + foto.name;
      const { data, error } = await supabase.storage.from('album').upload(nombreArchivo, foto);
      if(error) throw error;
    }));

    mensaje.innerText = `‚ú® Se guardaron ${fotosSeleccionadas.length} foto(s) ‚ú®`;
    fotosSeleccionadas = [];
  } catch(err){
    console.error(err);
    mensaje.innerText = "‚ùå Error al subir fotos";
  }
}

function verAlbum(){
  window.open("album.html", "_blank");
}

window.subirFotos = subirFotos;
window.abrirCamara = abrirCamara;
window.abrirGaleria = abrirGaleria;
window.verAlbum = verAlbum;
</script>

</body>
</html>
