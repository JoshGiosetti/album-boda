<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ricordi Eterni</title>
<style>
body { font-family:"Times New Roman", Times, serif; background:#0B3C91; text-align:center; padding:20px; margin:0; }
.box { background:#FFF; padding:25px; border-radius:14px; max-width:420px; margin:40px auto; box-shadow:0 6px 20px rgba(0,0,0,0.15);}
h1 { color:#0B3C91; margin-bottom:10px; }
p { color:#333; font-size:16px; margin:8px 0; }
button { margin-top:15px; padding:14px; width:100%; background:#0B3C91; border:none; color:#FFF; font-size:16px; border-radius:10px; cursor:pointer; }
button:hover { opacity:0.9; }
#mensaje { margin-top:15px; color:#0B3C91; }
#album { margin-top:20px; display:block; }
#album img { width:100%; border-radius:10px; margin-bottom:10px; }
input[type="file"] { display:none; }
</style>
</head>
<body>

<div class="box">
  <h1>‚ú® RICORDI ETERNI ‚ú®</h1>
  <p>üíç X & D üíç</p>

  <input type="file" id="cameraInput" accept="image/*" capture="environment" multiple>
  <input type="file" id="galleryInput" accept="image/*" multiple>

  <button onclick="abrirCamara()">Captura el momento</button>
  <button onclick="abrirGaleria()">Sube tu recuerdo</button>
  <button onclick="subirFotos()">Guardar tu recuerdo</button>

  <p id="mensaje"></p>
  <div id="album"></div>
</div>

<script>
const API_KEY = "0a5f721449bb9499e0f2049648e66abf"; // üîß reemplaza con tu API Key de ImgBB
let fotosSeleccionadas = [];

// Abrir c√°mara o galer√≠a
function abrirCamara(){ document.getElementById("cameraInput").click(); }
function abrirGaleria(){ document.getElementById("galleryInput").click(); }

document.getElementById("cameraInput").addEventListener("change", manejarFotos);
document.getElementById("galleryInput").addEventListener("change", manejarFotos);

function manejarFotos(e){
  fotosSeleccionadas = Array.from(e.target.files);
  document.getElementById("mensaje").innerText = fotosSeleccionadas.length + " foto(s) lista(s) para subir";
  mostrarMiniaturas();
}

function mostrarMiniaturas(){
  const album = document.getElementById("album");
  album.innerHTML = "";
  fotosSeleccionadas.forEach(foto=>{
    const img = document.createElement("img");
    img.src = URL.createObjectURL(foto);
    album.appendChild(img);
  });
}

// Subir fotos a ImgBB
async function subirFotos(){
  if(fotosSeleccionadas.length===0){
    document.getElementById("mensaje").innerText="No seleccionaste fotos";
    return;
  }
  document.getElementById("mensaje").innerText="Subiendo fotos...";

  for(let foto of fotosSeleccionadas){
    const formData = new FormData();
    formData.append("image", await toBase64(foto).then(b64=>b64.split(",")[1])); // ImgBB necesita base64
    formData.append("key", API_KEY);

    try{
      const res = await fetch("https://api.imgbb.com/1/upload", { method:"POST", body:formData });
      const data = await res.json();
      console.log("Foto subida:", data.data.url);

      // A√±adir la foto al √°lbum
      const album = document.getElementById("album");
      const img = document.createElement("img");
      img.src = data.data.url;
      album.prepend(img);

    }catch(err){
      console.error("Error al subir foto:", err);
    }
  }

  document.getElementById("mensaje").innerText="‚ú® Tus recuerdos fueron guardados ‚ú®";
  fotosSeleccionadas = [];
}

// Convertir archivo a base64
function toBase64(file){
  return new Promise((resolve, reject)=>{
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = ()=>resolve(reader.result);
    reader.onerror = error=>reject(error);
  });
}

// Botones
window.subirFotos = subirFotos;
window.abrirCamara = abrirCamara;
window.abrirGaleria = abrirGaleria;

</script>
</body>
</html>
